<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<img src="image.png" alt="My Logo" style="height: 100px;">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBM2hoB6SsSKywsbJoYkd8CWG1I46raBTY",
      authDomain: "abandonedtweaks-b47a2.firebaseapp.com",
      projectId: "abandonedtweaks-b47a2",
      storageBucket: "abandonedtweaks-b47a2.firebasestorage.app",
      messagingSenderId: "26177710755",
      appId: "1:26177710755:web:c804d0eef4be276a7c2d16",
      measurementId: "G-6H06DVYMCV"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged(user => {
      const btn = document.getElementById('auth-btn');
      if (user) {
        btn.textContent = 'Logout';
        btn.onclick = () => auth.signOut().then(() => window.location.reload());
      } else {
        btn.textContent = 'Login / Signup';
        btn.onclick = () => window.location.href = 'login.html';
      }
    });

    function generateRandomCode(length = 12) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    async function enterDiscountCode() {
      const user = auth.currentUser;
      if (!user) {
        alert('You must be logged in to enter a discount code.');
        return;
      }

      const code = prompt('Enter your discount code:');
      if (!code) return;

      if (code !== 'TikTok15') {
        alert('Invalid discount code.');
        return;
      }

      const usedRef = db.collection('discountCodesUsed').doc(user.uid);
      const doc = await usedRef.get();

      if (doc.exists) {
        alert('You have already used this discount code once.');
        return;
      }

      const randomCode = generateRandomCode();
      const timestamp = new Date();

      await usedRef.set({
        codeUsed: code,
        randomCode,
        usedAt: timestamp.toISOString()
      });

      alert(`Success! Your unique code is: ${randomCode}\nUsed on: ${timestamp.toLocaleString()}`);
    }

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('discountBtn').addEventListener('click', enterDiscountCode);
    });
  </script>

  <style>
    /* All your existing CSS here (kept as-is for brevity) */
  </style>
</head>
<body>
  <button id="auth-btn">Loading...</button>
  <div class="starry-background" id="stars"></div>

  <div id="intro-overlay" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999;">
    <h1 style="font-size:3rem; margin:0; background:linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); background-size:400% 400%; -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation:rainbow 8s linear infinite;">Abandoned Tweaks</h1>
    <p style="margin-top:1rem; font-size:1.2rem; color:#ccc; cursor:pointer;" onclick="enterSite()">click to enter</p>
  </div>

  <header>
    <h1 class="title">Abandoned Tweaks</h1>
  </header>

  <nav>
    <a href="https://discord.gg/qyZEhex3HJ" target="_blank">Discord</a>
    <a href="#">Purchase</a>
    <a href="https://www.tiktok.com/@abandonedtweaks" target="_blank">TikTok</a>
    <a href="https://abandonedtweaks.xyz/reviews.html" target="_blank">Reviews</a>
  </nav>

  <!-- rest of your content (products, etc.) goes here, unchanged -->

  <footer>
    &copy; 2025 Abandoned Tweaks. All rights reserved.
  </footer>

  <script>
    // createStar, createShootingStar functions here (kept as-is)
  </script>
  <script>
    function enterSite() {
      const overlay = document.getElementById('intro-overlay');
      overlay.style.opacity = '0';
      overlay.style.transition = 'opacity 0.8s ease';
      setTimeout(() => overlay.remove(), 800);
    }
  </script>
  <script>
    document.addEventListener('mousemove', e => {
      const dot = document.createElement('div');
      dot.classList.add('glow-dot');
      dot.style.left = e.clientX + 'px';
      dot.style.top = e.clientY + 'px';
      document.body.appendChild(dot);
      setTimeout(() => dot.remove(), 800);
    });
  </script>

  <button onclick="window.location.href='redeem.html'" style="position: fixed; bottom: 20px; left: 20px; padding: 12px 24px; font-size: 16px; font-weight: bold; color: #fff; background: linear-gradient(270deg, red, orange, yellow, green, blue, indigo, violet); background-size: 400% 400%; border: none; border-radius: 10px; cursor: pointer; animation: rainbow 6s linear infinite; z-index: 1000;">
    Redeem
  </button>

  <style>
    @keyframes rainbow {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
  </style>
</body>
</html>
