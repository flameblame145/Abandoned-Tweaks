<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Abandoned Tweaks</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBM2hoB6SsSKywsbJoYkd8CWG1I46raBTY",
      authDomain: "abandonedtweaks-b47a2.firebaseapp.com",
      projectId: "abandonedtweaks-b47a2",
      storageBucket: "abandonedtweaks-b47a2.firebasestorage.app",
      messagingSenderId: "26177710755",
      appId: "1:26177710755:web:c804d0eef4be276a7c2d16",
      measurementId: "G-6H06DVYMCV"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged(user => {
      const btn = document.getElementById('auth-btn');
      if (user) {
        btn.textContent = 'Logout';
        btn.onclick = () => auth.signOut().then(() => window.location.reload());
      } else {
        btn.textContent = 'Login / Signup';
        btn.onclick = () => window.location.href = 'login.html';
      }
    });

    function generateRandomCode(length = 12) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function showDiscountPanel() {
      document.getElementById('discountModal').style.display = 'block';
      document.getElementById('discountInput').value = '';
      document.getElementById('discountMessage').textContent = '';
    }

    function closeDiscountPanel() {
      document.getElementById('discountModal').style.display = 'none';
      document.getElementById('discountPanelContent').style.display = 'block';
      document.getElementById('discountSuccess').style.display = 'none';
    }

    async function submitDiscountCode() {
      const user = auth.currentUser;
      if (!user) {
        alert('You must be logged in to enter a discount code.');
        closeDiscountPanel();
        return;
      }

      const code = document.getElementById('discountInput').value.trim();
      if (!code) {
        alert('Please enter a discount code.');
        return;
      }

      if (code !== 'TikTok15') {
        alert('Invalid discount code.');
        return;
      }

      const usedRef = db.collection('discountCodesUsed').doc(user.uid);
      const doc = await usedRef.get();

      if (doc.exists) {
        alert('You have already used this discount code once.');
        closeDiscountPanel();
        return;
      }

      const randomCode = generateRandomCode();
      const timestamp = new Date();

      await usedRef.set({
        codeUsed: code,
        randomCode,
        usedAt: timestamp.toISOString()
      });

      document.getElementById('discountPanelContent').style.display = 'none';
      const successPanel = document.getElementById('discountSuccess');
      successPanel.style.display = 'block';
      successPanel.innerHTML = `
        <h2>Success!</h2>
        <p>Your unique order number is:</p>
        <p style="font-weight:bold; font-size:1.2rem;">${randomCode}</p>
        <p>Used on: ${timestamp.toLocaleString()}</p>
        <button onclick="closeDiscountPanel()">Close</button>
      `;
    }

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('discountBtn').addEventListener('click', showDiscountPanel);
      document.getElementById('discountSubmit').addEventListener('click', submitDiscountCode);
      document.getElementById('discountClose').addEventListener('click', closeDiscountPanel);
    });
  </script>

  <style>
    /* Keep all your existing styles here (header, rainbow, neon, products, stars, etc.) */

    /* Discount modal panel */
    #discountModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      border: 2px solid #00ffff;
      border-radius: 12px;
      box-shadow: 0 0 15px #00ffff;
      padding: 2rem;
      z-index: 2000;
      width: 320px;
      color: #0ff;
      font-weight: bold;
    }

    #discountModal input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: none;
      margin-top: 1rem;
      font-size: 1rem;
    }

    #discountModal button {
      margin-top: 1rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      background: #00ffff;
      color: #111;
      box-shadow: 0 0 10px #00ffff;
      transition: box-shadow 0.3s;
    }
    #discountModal button:hover {
      box-shadow: 0 0 20px #00ffff;
    }

    #discountClose {
      position: absolute;
      top: 10px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.2rem;
      color: #0ff;
      cursor: pointer;
      font-weight: bold;
    }
    #discountClose:hover {
      color: #00ffff;
    }
  </style>
</head>
<body>
  <button id="auth-btn">Loading...</button>
  <div class="starry-background" id="stars"></div>

  <header>
    <h1 class="title">Abandoned Tweaks</h1>
  </header>
  <nav>
    <a href="https://discord.gg/qyZEhex3HJ" target="_blank">Discord</a>
    <a href="#">Purchase</a>
    <a href="https://www.tiktok.com/@abandonedtweaks" target="_blank">TikTok</a>
  </nav>

  <!-- all your product cards here, unchanged! -->
  <div class="container">
    <div class="products">
      <!-- your existing product cards... -->
    </div>
  </div>

  <button id="discountBtn">Enter Discount Code</button>

  <div id="discountModal">
    <button id="discountClose" aria-label="Close">&times;</button>
    <div id="discountPanelContent">
      <h2>Enter Discount Code</h2>
      <input id="discountInput" type="text" placeholder="Enter code here..." />
      <button id="discountSubmit">Submit</button>
      <p id="discountMessage"></p>
    </div>
    <div id="discountSuccess" style="display:none;"></div>
  </div>

  <footer>
    &copy; 2025 Abandoned Tweaks. All rights reserved.
  </footer>

  <script>
    // Create stars
    function createStar() {
      const star = document.createElement('div');
      star.classList.add('star');
      const sizeClasses = ['small', 'medium', 'large'];
      star.classList.add(sizeClasses[Math.floor(Math.random() * sizeClasses.length)]);
      star.style.top = Math.random() * 100 + 'vh';
      star.style.left = Math.random() * 100 + 'vw';
      document.getElementById('stars').appendChild(star);
    }
    for(let i=0;i<80;i++) createStar();

    function createShootingStar() {
      const s = document.createElement('div');
      s.classList.add('shooting-star');
      s.style.top = '0px'; s.style.left = '0px';
      document.getElementById('stars').appendChild(s);
      setTimeout(()=>s.remove(),2000);
    }
    setInterval(createShootingStar,10000);
  </script>
</body>
</html>
